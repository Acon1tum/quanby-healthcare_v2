<div class="admin-profile-container main-content">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">My Profile</h1>
      <p class="page-description">Manage your personal information, preferences, and account settings</p>
    </div>
    <div class="header-actions">
      <button 
        *ngIf="!isEditing" 
        class="btn btn-primary" 
        (click)="startEditing()"
      >
        <i class="material-icons">edit</i>
        Edit Profile
      </button>
      <button 
        *ngIf="!isEditing" 
        class="btn btn-secondary" 
        (click)="openPasswordChange()"
      >
        <i class="material-icons">lock</i>
        Change Password
      </button>
    </div>
    <!-- Edit Actions -->
    <div *ngIf="isEditing" class="edit-actions">
      <button 
        type="button" 
        class="btn btn-secondary" 
        (click)="cancelEditing()"
        [disabled]="isSaving"
      >
        Cancel
      </button>
      &nbsp;
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="saveProfile()"
        [disabled]="isSaving || profileForm.invalid"
      >
        <span *ngIf="isSaving">Saving...</span>
        <span *ngIf="!isSaving">Save Changes</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading profile information...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && profile" class="profile-content">
    <!-- Profile Overview Card -->
    <div class="profile-overview">
      <div class="profile-header">
        <div class="profile-image-section">
          <div class="profile-image">
            <img 
              [src]="imagePreview || profile.profilePicture || 'assets/images/default-avatar.jpg'" 
              alt="Profile Image"
              class="avatar"
            >
            <div *ngIf="isEditing" class="image-upload-overlay">
              <input 
                type="file" 
                id="profileImage" 
                accept="image/*" 
                (change)="onImageSelected($event)"
                class="image-input"
              >
              <label for="profileImage" class="upload-label">
                <i class="material-icons">camera_alt</i>
                Change Photo
              </label>
            </div>
          </div>
          
          <div *ngIf="isEditing && (selectedImage || imagePreview)" class="image-actions">
            <button 
              class="btn btn-sm btn-danger" 
              (click)="removeSelectedImage()"
              title="Remove selected image"
            >
              <i class="material-icons">delete</i>
            </button>
          </div>
        </div>
        
        <div class="profile-info">
          <h2 class="profile-name">{{ getFullName() }}</h2>
          <p class="profile-role">{{ roleLabel }}</p>
          <p class="profile-department">{{ departmentLabel }}</p>
          
          <!-- Organization Information -->
          <div *ngIf="organization" class="organization-info">
            <div class="org-item">
              <i class="material-icons">business</i>
              <span class="org-name">{{ organizationName }}</span>
            </div>
            <div *ngIf="organizationDescription" class="org-item">
              <i class="material-icons">description</i>
              <span class="org-description">{{ organizationDescription }}</span>
            </div>
            <div *ngIf="organizationAddress" class="org-item">
              <i class="material-icons">location_on</i>
              <span class="org-address">{{ organizationAddress }}</span>
            </div>
          </div>
          
          <div class="profile-stats">
            <div class="stat-item">
              <i class="material-icons">badge</i>
              <span>{{ profile.id }}</span>
            </div>
            <div class="stat-item" *ngIf="getAge() > 0">
              <i class="material-icons">cake</i>
              <span>{{ getAge() }} years old</span>
            </div>
            <div class="stat-item">
              <i class="material-icons">work</i>
              <span>{{ getYearsOfService() }} years of service</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Details -->
    <div class="profile-details">
      <div class="details-grid">
        <!-- Personal Information -->
        <div class="detail-section">
          <h3 class="section-title">
            <i class="material-icons">person</i>
            Personal Information
          </h3>
          
          <div *ngIf="!isEditing" class="info-grid">
            <div class="info-item">
              <label>Email</label>
              <span>{{ profile.email }}</span>
            </div>
            <div class="info-item" *ngIf="profile.doctorInfo?.gender || profile.patientInfo?.gender">
              <label>Gender</label>
              <span>{{ (profile.doctorInfo?.gender || profile.patientInfo?.gender) === 'MALE' ? 'Male' : (profile.doctorInfo?.gender || profile.patientInfo?.gender) === 'FEMALE' ? 'Female' : 'Other' }}</span>
            </div>
            <div class="info-item" *ngIf="profile.doctorInfo?.dateOfBirth || profile.patientInfo?.dateOfBirth">
              <label>Date of Birth</label>
              <span>{{ (profile.doctorInfo?.dateOfBirth || profile.patientInfo?.dateOfBirth) | date:'longDate' }}</span>
            </div>
          </div>
          
          <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
            
            <div class="form-row">
              <div class="form-group">
                <label for="gender">Gender *</label>
                <select id="gender" formControlName="gender" class="form-control" required>
                  <option value="">Select Gender</option>
                  <option *ngFor="let option of genderOptions" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="dateOfBirth">Date of Birth *</label>
                <input 
                  type="date" 
                  id="dateOfBirth" 
                  formControlName="dateOfBirth" 
                  class="form-control" 
                  required
                >
              </div>
              
              <div class="form-group">
                <label for="contactNumber">Email</label>
                <input 
                  type="email" 
                  id="contactNumber" 
                  formControlName="contactNumber" 
                  class="form-control"
                  readonly
                >
              </div>
            </div>      
          </form>
        </div>

        <!-- Professional Information -->
        <div class="detail-section">
          <h3 class="section-title">
            <i class="material-icons">work</i>
            Professional Information
          </h3>
          
          <div *ngIf="!isEditing" class="info-grid">
            <div class="info-item">
              <label>Organization</label>
              <span>{{ organizationName }}</span>
            </div>
            <div class="info-item">
              <label>Member Since</label>
              <span>{{ profile.createdAt | date:'longDate' }}</span>
            </div>
          
            <div *ngIf="organization.website" class="info-item">
              <label>Website</label>
              <span>
                <a [href]="organization.website" target="_blank" class="website-link">{{ organization.website }}</a>
              </span>
            </div>
            <div class="info-item">
              <label>Status</label>
              <span class="status-badge" [class.status-active]="organization.isActive" [class.status-inactive]="!organization.isActive">
                {{ organization.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>

          <!-- Organization Information Edit Form -->
          <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
            <div class="organization-form-section">
              <h4 class="form-section-title">Organization Information</h4>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="orgName">Organization Name</label>
                  <input 
                    type="text" 
                    id="orgName" 
                    formControlName="orgName" 
                    class="form-control" 
                    placeholder="Organization name"
                    readonly
                  >
                </div>
                <div class="form-group">
                  <label for="orgStatus">Status</label>
                  <input 
                    type="text" 
                    id="orgStatus" 
                    formControlName="orgStatus" 
                    class="form-control" 
                    readonly
                  >
                </div>
              </div>


              <div class="form-group">
                <label for="orgDescription">Description</label>
                <textarea 
                  id="orgDescription" 
                  formControlName="orgDescription" 
                  class="form-control" 
                  rows="3"
                  readonly
                ></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="orgAddress">Address</label>
                  <textarea 
                    id="orgAddress" 
                    formControlName="orgAddress" 
                    class="form-control" 
                    rows="2"
                    readonly
                  ></textarea>
                </div>
              </div>


              <div class="form-row">
                <div class="form-group">
                  <label for="orgPhone">Phone</label>
                  <input 
                    type="text" 
                    id="orgPhone" 
                    formControlName="orgPhone" 
                    class="form-control" 
                    readonly
                  >
                </div>
                <div class="form-group">
                  <label for="orgEmail">Email</label>
                  <input 
                    type="email" 
                    id="orgEmail" 
                    formControlName="orgEmail" 
                    class="form-control" 
                    readonly
                  >
                </div>
              </div>

              <div class="form-group">
                <label for="orgWebsite">Website</label>
                <input 
                  type="url" 
                  id="orgWebsite" 
                  formControlName="orgWebsite" 
                  class="form-control" 
                  readonly
                >
              </div>
            </div>
          </form>
        </div>

        <!-- Bio Section -->
        <div class="detail-section">
          <h3 class="section-title">
            <i class="material-icons">description</i>
            Biography
          </h3>
          
          <div *ngIf="!isEditing" class="bio-content">
            <p>{{ profile.doctorInfo?.bio || 'No bio available' }}</p>
          </div>
          
          <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
            <div class="form-group">
              <label for="bio">Bio *</label>
              <textarea 
                id="bio" 
                formControlName="bio" 
                class="form-control" 
                rows="4"
                [class.ng-invalid]="bio?.invalid && bio?.touched"
              ></textarea>
              <div *ngIf="bio?.invalid && bio?.touched" class="error-message">
                <span *ngIf="bio?.errors?.['required']">Bio is required</span>
                <span *ngIf="bio?.errors?.['minlength']">Bio must be at least 20 characters</span>
              </div>
            </div>
          </form>
        </div>

        <!-- Emergency Contact -->
        <div class="detail-section">
          <h3 class="section-title">
            <i class="material-icons">emergency</i>
            Emergency Contact
          </h3>
          
          <div *ngIf="!isEditing && profile?.patientInfo?.emergencyContact" class="info-grid">
            <div class="info-item">
              <label>Name</label>
              <span>{{ profile.patientInfo?.emergencyContact?.contactName }}</span>
            </div>
            <div class="info-item">
              <label>Relationship</label>
              <span>{{ profile.patientInfo?.emergencyContact?.relationship }}</span>
            </div>
            <div class="info-item">
              <label>Phone</label>
              <span>{{ profile.patientInfo?.emergencyContact?.contactNumber }}</span>
            </div>
          </div>
          
          <!-- Organization Contact Information -->
          <div *ngIf="!isEditing && organization" class="organization-contact-info">
            <div class="info-grid">
              <div *ngIf="organization.phone" class="info-item">
                <label>Organization Phone</label>
                <span>{{ organization.phone }}</span>
              </div>
              <div *ngIf="organization.email" class="info-item">
                <label>Organization Email</label>
                <span>{{ organization.email }}</span>
              </div>
            </div>
          </div>
          
          <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
            
            <!-- Organization Contact Information in Edit Mode -->
            <div *ngIf="organization" class="organization-contact-form">
              <h4 class="form-section-title">Organization Contact</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="orgPhone">Organization Phone</label>
                  <input 
                    type="text" 
                    id="orgPhone" 
                    formControlName="orgPhone" 
                    class="form-control" 
                    readonly
                  >
                </div>
                <div class="form-group">
                  <label for="orgEmail">Organization Email</label>
                  <input 
                    type="email" 
                    id="orgEmail" 
                    formControlName="orgEmail" 
                    class="form-control" 
                    readonly
                  >
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Preferences -->
        <div class="detail-section">
          <h3 class="section-title">
            <i class="material-icons">settings</i>
            Preferences
          </h3>
          
          <div *ngIf="!isEditing" class="info-grid">
            <div class="info-item">
              <label>Language</label>
              <span>{{ languageLabel }}</span>
            </div>
            <div class="info-item">
              <label>Timezone</label>
              <span>{{ timezoneLabel }}</span>
            </div>
            <div class="info-item">
              <label>Notifications</label>
              <span>{{ notificationLabels }}</span>
            </div>
          </div>
          
          <form *ngIf="isEditing" [formGroup]="profileForm" class="edit-form">
            <div class="form-row">
              <div class="form-group">
                <label for="language">Language *</label>
                <select id="language" formControlName="language" class="form-control" required>
                  <option value="">Select Language</option>
                  <option *ngFor="let option of languageOptions" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="timezone">Timezone *</label>
                <select id="timezone" formControlName="timezone" class="form-control" required>
                  <option value="">Select Timezone</option>
                  <option *ngFor="let option of timezoneOptions" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label>Notification Preferences</label>
              <div class="checkbox-group">
                <label class="checkbox-item">
                  <input type="checkbox" formControlName="emailNotifications">
                  Email Notifications
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" formControlName="smsNotifications">
                  SMS Notifications
                </label>
                <label class="checkbox-item">
                  <input type="checkbox" formControlName="pushNotifications">
                  Push Notifications
                </label>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Dialog -->
  <div *ngIf="isChangingPassword" class="dialog-overlay" (click)="closePasswordChange()">
    <div class="dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h2>Change Password</h2>
        <button class="btn btn-icon" (click)="closePasswordChange()">
          <i class="material-icons">close</i>
        </button>
      </div>
      
      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="dialog-form">
        <div class="form-group">
          <label for="currentPassword">Current Password *</label>
          <input 
            type="password" 
            id="currentPassword" 
            formControlName="currentPassword" 
            class="form-control"
            [class.ng-invalid]="currentPassword?.invalid && currentPassword?.touched"
          >
          <div *ngIf="currentPassword?.invalid && currentPassword?.touched" class="error-message">
            <span *ngIf="currentPassword?.errors?.['required']">Current password is required</span>
            <span *ngIf="currentPassword?.errors?.['minlength']">Password must be at least 8 characters</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="newPassword">New Password *</label>
          <input 
            type="password" 
            id="newPassword" 
            formControlName="newPassword" 
            class="form-control"
            [class.ng-invalid]="newPassword?.invalid && newPassword?.touched"
          >
          <div *ngIf="newPassword?.invalid && newPassword?.touched" class="error-message">
            <span *ngIf="newPassword?.errors?.['required']">New password is required</span>
            <span *ngIf="newPassword?.errors?.['minlength']">Password must be at least 8 characters</span>
            <span *ngIf="newPassword?.errors?.['pattern']">Password must contain uppercase, lowercase, number, and special character</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password *</label>
          <input 
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword" 
            class="form-control"
            [class.ng-invalid]="confirmPassword?.invalid && confirmPassword?.touched"
          >
          <div *ngIf="confirmPassword?.invalid && confirmPassword?.touched" class="error-message">
            <span *ngIf="confirmPassword?.errors?.['required']">Please confirm your new password</span>
          </div>
          <div *ngIf="passwordForm.errors?.['passwordMismatch'] && confirmPassword?.touched" class="error-message">
            Passwords do not match
          </div>
        </div>
        
        <div class="password-requirements">
          <h4>Password Requirements:</h4>
          <ul>
            <li>At least 8 characters long</li>
            <li>Contains uppercase letter (A-Z)</li>
            <li>Contains lowercase letter (a-z)</li>
            <li>Contains number (0-9)</li>
                         <li>Contains special character (&#64;$!%*?&)</li>
          </ul>
        </div>
        
        <div class="dialog-actions">
          <button type="button" class="btn btn-secondary" (click)="closePasswordChange()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="isSaving || passwordForm.invalid">
            <span *ngIf="isSaving">Changing...</span>
            <span *ngIf="!isSaving">Change Password</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
