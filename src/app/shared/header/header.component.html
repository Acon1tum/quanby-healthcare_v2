<header class="fixed top-0 z-50 flex items-center whitespace-nowrap border-b border-solid border-b-gray-200/60 bg-white/80 px-4 md:px-6 lg:px-10 py-3 md:py-4 backdrop-blur-sm" 
        [class.with-sidebar]="hasSidebar"
        [class.logged-in]="isLoggedIn"
        [class.justify-between]="!isLoggedIn"
        [class.justify-evenly]="isLoggedIn">
  <!-- Logo Section - Only show when not logged in -->
  <div *ngIf="!isLoggedIn" class="flex items-center gap-2 md:gap-3 text-slate-800">
    <img src="/QHEALTH.png" alt="Quanby Health Logo" class="h-8 w-18 md:h-8 md:w-8">
  </div>

  <!-- Mobile Sidebar Button - Only show when logged in on mobile -->
  <div *ngIf="isLoggedIn" class="lg:hidden relative">
    <button 
      (click)="toggleSidebar()" 
      class="mobile-sidebar-button flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-100 transition-colors"
      aria-label="Toggle sidebar"
    >
      <svg class="w-6 h-6 text-slate-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

      <!-- Mobile Sidebar Dropdown -->
      <div 
        #sidebarDropdown
        [class.hidden]="!isSidebarOpen"
        class="mobile-sidebar-dropdown absolute left-0 top-full mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 pb-1 z-50"
      >
      <!-- Mobile Sidebar Header -->
      <div class="px-4 py-2 border-b border-gray-100">
        <div class="flex items-center gap-2">
          <img src="/QHEALTH.png" alt="Quanby Health Logo" class="h-7 w-17">
        </div>
      </div>

      <!-- Mobile Sidebar Navigation -->
      <div class="max-h-80 overflow-y-auto">
        <ng-container *ngFor="let item of navigationItems">
          <!-- Regular navigation item -->
          <div *ngIf="!item.children">
            <a 
              [routerLink]="item.route" 
              routerLinkActive="active"
              (click)="closeSidebar()"
              class="flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
            >
              <i class="material-icons text-base">{{ item.icon }}</i>
              <span>{{ item.label }}</span>
            </a>
          </div>
          
          <!-- Navigation item with children -->
          <div *ngIf="item.children">
            <button 
              (click)="toggleSection(item)"
              class="w-full flex items-center justify-between px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
            >
              <div class="flex items-center gap-2">
                <i class="material-icons text-base">{{ item.icon }}</i>
                <span>{{ item.label }}</span>
              </div>
              <i class="material-icons text-base transition-transform" [class.rotate-180]="item.expanded">
                expand_more
              </i>
            </button>
            
            <div *ngIf="item.expanded" class="ml-6">
              <ng-container *ngFor="let child of item.children">
                <a 
                  [routerLink]="child.route" 
                  routerLinkActive="active"
                  (click)="closeSidebar()"
                  class="flex items-center gap-2 px-4 py-1 text-xs text-gray-600 hover:bg-gray-50 transition-colors"
                >
                  <i class="material-icons text-sm">{{ child.icon }}</i>
                  <span>{{ child.label }}</span>
                </a>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Desktop Navigation -->
  <div class="hidden lg:flex flex-1 justify-end gap-6">
    <!-- Not Logged In -->
    <nav *ngIf="!isLoggedIn" class="flex items-center gap-8">
      <a class="text-gray-600 hover:text-slate-800 text-sm font-medium leading-normal transition-colors" href="#">Home</a>
      <a class="text-gray-600 hover:text-slate-800 text-sm font-medium leading-normal transition-colors" href="#features">Features</a>
      <a class="text-gray-600 hover:text-slate-800 text-sm font-medium leading-normal transition-colors" href="#how-it-works">How it Works</a>
      <a (click)="navigateToLogin()" class="text-gray-600 hover:text-slate-800 text-sm font-medium leading-normal transition-colors cursor-pointer">Login</a>
    </nav>
    
    <!-- Logged In User -->
    <div *ngIf="isLoggedIn" class="flex items-center gap-6">
      <button 
        (click)="navigateToProfile()"
        class="flex items-center gap-3 hover:bg-gray-50 p-2 rounded-lg transition-colors cursor-pointer group"
      >
        <div class="text-right">
          <p class="text-sm font-medium text-slate-800 group-hover:text-sky-600 transition-colors">{{ getUserDisplayName() }}</p>
          <p class="text-xs text-gray-500 capitalize group-hover:text-sky-500 transition-colors">{{ currentUser?.role }}</p>
        </div>
        <div class="w-8 h-8 bg-sky-500 rounded-full flex items-center justify-center group-hover:bg-sky-600 transition-colors">
          <span class="text-white text-sm font-medium">{{ (getUserDisplayName() || 'U').charAt(0) }}</span>
        </div>
      </button>
    </div>
    
    <div class="flex gap-3">
      <!-- Not Logged In -->
      <button *ngIf="!isLoggedIn" (click)="navigateToRegister()" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-5 bg-transparent border border-sky-500 text-slate-800 text-sm font-bold leading-normal tracking-[0.015em] hover:bg-sky-500/10 transition-colors">
        <span class="truncate">Sign Up</span>
      </button>
      
      <!-- Try Demo - Only for non-logged in users -->
      <button *ngIf="!isLoggedIn" (click)="navigateToFaceScan()" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-5 bg-sky-500 text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-opacity-90 transition-opacity">
        <span class="truncate">Try Demo</span>
      </button>
    </div>
  </div>

  <!-- Mobile Profile Button for Logged In Users -->
  <div *ngIf="isLoggedIn" class="lg:hidden relative">
    <button 
      (click)="toggleProfileDropdown()" 
      class="mobile-profile-button flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors"
      aria-label="Toggle profile menu"
    >
      <div class="w-8 h-8 bg-sky-500 rounded-full flex items-center justify-center">
        <span class="text-white text-sm font-medium">{{ (getUserDisplayName() || 'U').charAt(0) }}</span>
      </div>
      <svg class="w-4 h-4 text-slate-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>

    <!-- Profile Dropdown Menu -->
    <div 
      #profileDropdown
      *ngIf="isProfileDropdownOpen"
      class="mobile-profile-dropdown absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 pb-1 z-50"
    >
      <div class="px-4 py-2 border-b border-gray-100">
        <p class="text-sm font-medium text-slate-800">{{ getUserDisplayName() }}</p>
        <p class="text-xs text-gray-500 capitalize">{{ currentUser?.role }}</p>
      </div>
      <button 
        (click)="navigateToProfile(); closeProfileDropdown()"
        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
      >
        <i class="material-icons text-base mr-2">person</i>
        My Profile
      </button>
      <!-- Mobile Sidebar Footer -->
      <div class="px-4 py-2 border-t border-gray-100">
        <button 
          (click)="logout(); closeSidebar()"
          class="w-full flex items-center gap-2 px-0 py-0 text-sm text-red-600 hover:bg-red-50 transition-colors"
        >
          <i class="material-icons text-base">logout</i>
          <span>Logout</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Button for Non-Logged In Users -->
  <button 
    *ngIf="!isLoggedIn"
    (click)="toggleMobileMenu()" 
    class="mobile-menu-button lg:hidden flex items-center justify-center w-10 h-10 rounded-lg hover:bg-gray-100 transition-colors"
    aria-label="Toggle mobile menu"
  >
    <svg class="hamburger-icon w-6 h-6 text-slate-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            [attr.d]="isMobileMenuOpen ? 'M6 18L18 6M6 6l12 12' : 'M4 6h16M4 12h16M4 18h16'">
      </path>
    </svg>
  </button>

  <!-- Mobile Menu Overlay -->
  <div 
    #mobileMenu
    [class.hidden]="!isMobileMenuOpen"
    class="mobile-menu-overlay lg:hidden fixed inset-0 top-16 border-t border-gray-200 z-40"
    style="background-color: #ffffff;"
  >
    <nav class="mobile-menu-content flex flex-col p-4 space-y-4">
      <!-- Not Logged In -->
      <div *ngIf="!isLoggedIn">
        <a (click)="closeMobileMenu()" class="mobile-nav-link text-gray-600 hover:text-slate-800 text-base font-medium leading-normal transition-colors py-2" href="#">Home</a>
        <a (click)="closeMobileMenu()" class="mobile-nav-link text-gray-600 hover:text-slate-800 text-base font-medium leading-normal transition-colors py-2" href="#features">Features</a>
        <a (click)="closeMobileMenu()" class="mobile-nav-link text-gray-600 hover:text-slate-800 text-base font-medium leading-normal transition-colors py-2" href="#how-it-works">How it Works</a>
        <a (click)="navigateToLogin()" class="mobile-nav-link text-gray-600 hover:text-slate-800 text-base font-medium leading-normal transition-colors py-2 cursor-pointer">Login</a>
        
        <!-- Mobile Buttons -->
        <div class="flex flex-col gap-3 pt-4 border-t border-gray-200">
          <button (click)="navigateToRegister()" class="flex items-center justify-center rounded-lg h-12 px-5 bg-transparent border border-sky-500 text-slate-800 text-base font-bold leading-normal tracking-[0.015em] hover:bg-sky-500/10 transition-colors">
            Sign Up
          </button>
          <button (click)="navigateToFaceScan()" class="flex items-center justify-center rounded-lg h-12 px-5 bg-sky-500 text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-opacity-90 transition-opacity">
            Try Demo
          </button>
        </div>
      </div>
      
      <!-- Logged In User -->
      <div *ngIf="isLoggedIn">
        <button 
          (click)="navigateToProfile(); closeMobileMenu()"
          class="w-full flex items-center gap-3 p-3 bg-gray-50 rounded-lg mb-4 hover:bg-gray-100 transition-colors cursor-pointer group"
        >
          <div class="w-10 h-10 bg-sky-500 rounded-full flex items-center justify-center group-hover:bg-sky-600 transition-colors">
            <span class="text-white text-sm font-medium">{{ (getUserDisplayName() || 'U').charAt(0) }}</span>
          </div>
          <div>
            <p class="text-sm font-medium text-slate-800 group-hover:text-sky-600 transition-colors">{{ getUserDisplayName() }}</p>
            <p class="text-xs text-gray-500 capitalize group-hover:text-sky-500 transition-colors">{{ currentUser?.role }}</p>
          </div>
        </button>
        
        <div class="flex flex-col gap-3 pt-4 border-t border-gray-200">
          <p class="text-sm text-gray-500 text-center">Navigation available in sidebar</p>
        </div>
      </div>
    </nav>
  </div>
</header> 